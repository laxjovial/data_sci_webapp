{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2 class="mb-4">Data Combining</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                Combine DataFrames
            </div>
            <div class="card-body">
                <form action="{{ url_for('data_combining') }}" method="POST">
                    <div class="mb-3">
                        <label for="left_df" class="form-label">First DataFrame</label>
                        <select class="form-control" id="left_df" name="left_df" required>
                            <option value="" disabled selected>Select a DataFrame</option>
                            {% for df_name in dataframes %}
                                <option value="{{ df_name }}">{{ df_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="right_df" class="form-label">Second DataFrame</label>
                        <select class="form-control" id="right_df" name="right_df" required>
                            <option value="" disabled selected>Select a DataFrame</option>
                            {% for df_name in dataframes %}
                                <option value="{{ df_name }}">{{ df_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Combination Method</label>
                        <div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="method" id="methodMerge" value="merge" required>
                                <label class="form-check-label" for="methodMerge">Merge</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="method" id="methodConcat" value="concat">
                                <label class="form-check-label" for="methodConcat">Concat</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="method" id="methodJoin" value="join">
                                <label class="form-check-label" for="methodJoin">Join</label>
                            </div>
                        </div>
                    </div>
                    
                    <div id="merge-options" style="display: none;">
                        <div class="mb-3">
                            <label for="merge_on" class="form-label">Column to Merge On</label>
                            <select class="form-control" id="merge_on" name="on">
                                <option value="" disabled selected>Select a column</option>
                                {% for column in columns %}
                                    <option value="{{ column }}">{{ column }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="merge_how" class="form-label">Merge Type</label>
                            <select class="form-control" id="merge_how" name="how">
                                <option value="inner">Inner</option>
                                <option value="outer">Outer</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                            </select>
                        </div>
                    </div>

                    <div id="concat-options" style="display: none;">
                        <div class="mb-3">
                            <label for="concat_axis" class="form-label">Axis</label>
                            <select class="form-control" id="concat_axis" name="axis">
                                <option value="0">0 (Rows)</option>
                                <option value="1">1 (Columns)</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary mt-3">Combine Data</button>
                </form>
            </div>
        </div>
    </div>
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                Combined Data
            </div>
            <div class="card-body">
                {% if error %}
                    <div class="alert alert-danger">{{ error }}</div>
                {% endif %}
                {% if combined_df %}
                    {{ combined_df | safe }}
                {% else %}
                    <p>No combined data to display yet. Combine two DataFrames to see results.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const methodRadios = document.querySelectorAll('input[name="method"]');
    const mergeOptions = document.getElementById('merge-options');
    const concatOptions = document.getElementById('concat-options');

    function toggleOptions() {
        if (document.getElementById('methodMerge').checked) {
            mergeOptions.style.display = 'block';
            concatOptions.style.display = 'none';
        } else if (document.getElementById('methodConcat').checked) {
            mergeOptions.style.display = 'none';
            concatOptions.style.display = 'block';
        } else {
            mergeOptions.style.display = 'none';
            concatOptions.style.display = 'none';
        }
    }

    methodRadios.forEach(radio => radio.addEventListener('change', toggleOptions));
    toggleOptions(); // Initial call to set visibility on page load
});
</script>
{% endblock %}
