{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2 class="mb-4">Data and Feature Engineering</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                Create New Feature
            </div>
            <div class="card-body">
                <form action="{{ url_for('data_engineering') }}" method="POST">
                    <input type="hidden" name="action" value="create_new_feature">
                    <div class="mb-3">
                        <label for="col1" class="form-label">Column 1</label>
                        <select class="form-control" id="col1" name="col1" required>
                            <option value="" disabled selected>Select a column</option>
                            {% for column in columns %}
                                <option value="{{ column }}">{{ column }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="col2" class="form-label">Column 2</label>
                        <select class="form-control" id="col2" name="col2" required>
                            <option value="" disabled selected>Select a column</option>
                            {% for column in columns %}
                                <option value="{{ column }}">{{ column }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="operation" class="form-label">Operation</label>
                        <select class="form-control" id="operation" name="operation" required>
                            <option value="" disabled selected>Select an operation</option>
                            <option value="add">Add (+)</option>
                            <option value="subtract">Subtract (-)</option>
                            <option value="multiply">Multiply (*)</option>
                            <option value="divide">Divide (/)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="new_col_name" class="form-label">New Column Name</label>
                        <input type="text" class="form-control" id="new_col_name" name="new_col_name" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Feature</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                Apply Encoding
            </div>
            <div class="card-body">
                <form action="{{ url_for('data_engineering') }}" method="POST">
                    <input type="hidden" name="action" value="apply_encoding">
                    <div class="mb-3">
                        <label for="encoding_columns" class="form-label">Columns (Select multiple)</label>
                        <select class="form-control" id="encoding_columns" name="columns[]" multiple required>
                            {% for column in columns %}
                                <option value="{{ column }}">{{ column }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="encoding_type" class="form-label">Encoding Type</label>
                        <select class="form-control" id="encoding_type" name="encoding_type" required>
                            <option value="" disabled selected>Select a type</option>
                            <option value="one_hot">One-Hot Encoding</option>
                            <option value="label">Label Encoding</option>
                            <option value="ordinal">Ordinal Encoding</option>
                            <option value="frequency">Frequency Encoding</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Apply Encoding</button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                Bin Column
            </div>
            <div class="card-body">
                <form action="{{ url_for('data_engineering') }}" method="POST">
                    <input type="hidden" name="action" value="bin_column">
                    <div class="mb-3">
                        <label for="bin_column" class="form-label">Numeric Column to Bin</label>
                        <select class="form-control" id="bin_column" name="column" required>
                            <option value="" disabled selected>Select a column</option>
                            {% for column in columns %}
                                <option value="{{ column }}">{{ column }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="num_bins" class="form-label">Number of Bins</label>
                        <input type="number" class="form-control" id="num_bins" name="num_bins" min="2" required>
                    </div>
                    <div class="mb-3">
                        <label for="bin_labels" class="form-label">Custom Labels (Optional, comma-separated)</label>
                        <input type="text" class="form-control" id="bin_labels" name="labels" placeholder="e.g., Small, Medium, Large">
                    </div>
                    <div class="mb-3">
                        <label for="new_bin_col_name" class="form-label">New Column Name (Optional)</label>
                        <input type="text" class="form-control" id="new_bin_col_name" name="new_col_name">
                    </div>
                    <button type="submit" class="btn btn-primary">Apply Binning</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                Current Data
            </div>
            <div class="card-body">
                {% if error %}
                    <div class="alert alert-danger">{{ error }}</div>
                {% endif %}
                {% if success %}
                    <div class="alert alert-success">{{ success }}</div>
                {% endif %}
                {% if data_viewer %}
                    {{ data_viewer|safe }}
                {% else %}
                    <p>No data to display. Please import a dataset first.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
